"use strict";function startVideo(a,i,e=!1,t="user"){navigator.mediaDevices.getUserMedia(e?{audio:!1,video:{width:{ideal:4096}}}:{audio:!1,video:{facingMode:t,height:{ideal:600,min:480}}}).then(function(t){isVirtualDevice(t)||(console.log("Media stream created:",t.getVideoTracks()[0]),a.srcObject=t,a.onloadedmetadata=function(e){console.log("Playing live media stream"),a.play(),i&&i(a,t)})}).catch(function(e){console.log("getUserMedia() error: ",e),alert(e.name+": "+e.message)})}function stopVideo(e){let t=e.srcObject;return!!t&&(t.getTracks().forEach(e=>{e.stop()}),e.pause(),!(e.srcObject=null))}function createTemplate(t){var a={centerX:t.width/2,centerY:t.height/2,width:t.width/4,height:t.height/4+t.height/8};a.xPos=a.centerX-a.width/2,a.yPos=a.centerY-a.height/2,a.buffer=new Uint8ClampedArray(a.width*a.height);let i=0;for(var o=t.data,r=a.yPos;r<a.yPos+a.height;r++){let e=r*t.width*4+4*a.xPos+1;for(var n=a.xPos;n<a.xPos+a.width;n++){var s=o[e];a.buffer[i++]=s,e+=4}}return console.log("Created new cross-correlation template",a),a}function motionDetection(o,r){let n=0,s=0,c=0,e=o.width/4,t=o.height/4,d=o.data;for(var l=r.centerY-t;l<=r.centerY+t-r.height;l++)for(var g=r.centerX-e;g<=r.centerX+e-r.width;g++){let t=0,a=0,i=0;for(var h=0;h<r.height;h++){let e=4*g+1+(l+h)*o.width*4;for(var v=0;v<r.width;v++){var u=d[e];t+=r.buffer[i++]*u,a+=u*u,e+=4}}let e=0;0<a&&(e=t*t/a),e>c&&(c=e,n=g,s=l)}var a=n-r.xPos,i=s-r.yPos,f=Math.sqrt(a*a+i*i),a=e-r.width/2,i=t-r.height/2;let m=f/Math.sqrt(a*a+i*i)*100;return 100<m&&(m=100),console.log("Calculated movement: ",m),m}function isVirtualDevice(e){let t=!1,a=e.getVideoTracks()[0].label.toLowerCase();for(const i of["OBS Virtual Camera","OBS-Camera","e2eSoft VCAM","Avatarify","ManyCam Virtual","Logi Capture","Snap Camera"])if(a.includes(i.toLowerCase())&&(t=!0,console.log("Virtual camera detected: "+a),t)){alert("Virtual camera ("+i+") was detected and access is denied. Video injection is not allowed!");break}return t}void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(a,e,t){var i=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return i?new Promise(function(e,t){i.call(navigator,a,e,t)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(o,r,n){console.log("using toBlob poyfill based on toDataURL");var s=this;setTimeout(function(){for(var e=atob(s.toDataURL(r,n).split(",")[1]),t=e.length,a=new Uint8Array(t),i=0;i<t;i++)a[i]=e.charCodeAt(i);o(new Blob([a],{type:r||"image/png"}))})}});